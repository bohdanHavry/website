<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Bootstrap CSS -->

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel/slick/slick.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel/slick/slick-theme.css" />


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
          integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn"
          crossorigin="anonymous">

    <title>AVTOSENAT</title>
    <style>
        .navbar-nav {
            margin-left: auto;
            margin-right: auto;
        }
        .nav-link{
        font-size:20px;
        color:white !important;
        }


        @media(max-width: 1199px){
        .carousel-item img{
        height:500px!important;
        }


        @media(max-width: 946px){
        .carousel-item img{
        height:400px!important;
        }
        .form-group{
        display: flex;
        gap: 20px;
        flex-direction: column;
        }
        .buttons button{
        width:100%!important;
        }

        .nav-link{
        font-size:15px;
        }

        .navbar-nav{
        gap:10px!important;
        }

        }

        @media(max-width: 768px){
        .search{
        display: flex!important;
        flex-direction:column;
        justify-content: center!important;
        align-items: center;
        }
        .search button{
        width:50%!important;
        }
        .logo{
        height:50px!important;
        width:100px!important;
        }

        }

        @media(max-width: 425px){
        .carousel-item img{
        height:250px!important;
        }


    </style>
</head>
<body>
<nav class="navbar navbar-dark bg-dark navbar-expand-md" style="display: flex; justify-content:space-between;">
    <div class="container-fluid">

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <a href="/">
            <img class="logo" style="height:100px; width:200px" src="/static/images/logo.png">
        </a>

        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav" style="gap: 25px">
                <li class="nav-item">
                    <a style="text-decoration:none;" href="/">
                        <span class="nav-link">Головна</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a style="text-decoration:none;" href="/about">
                        <span class="nav-link">Про нас</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a style="text-decoration:none;" href="/shop">
                        <span class="nav-link">Магазин</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a style="text-decoration:none;" href="/paymentAndDelivery">
                        <span class="nav-link">Доставка та оплата</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a style="text-decoration:none;" href="/contacts">
                        <span class="nav-link">Контакти</span>
                    </a>
                </li>
            </ul>
        </div>
        <div th:if="${user.login}">
            <div class="dropdown text-end">
                <a href="/cart" class="link1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" class="bi bi-bag-check-fill" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M10.5 3.5a2.5 2.5 0 0 0-5 0V4h5v-.5zm1 0V4H15v10a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V4h3.5v-.5a3.5 3.5 0 1 1 7 0zm-.646 5.354a.5.5 0 0 0-.708-.708L7.5 10.793 6.354 9.646a.5.5 0 1 0-.708.708l1.5 1.5a.5.5 0 0 0 .708 0l3-3z"/>
                    </svg>
                </a>
                <a href="/profile">
                    <img src="/static/images/1.png" alt="mdo"
                         width="42" height="42" class="rounded-circle">
                </a>
            </div>
        </div>
        <span th:unless="${user.login}">
            <button class="btn btn-light my-2 my-sm-0" type="button"
                    onclick="window.location.href = '/login'">
                Увійти
            </button>
        </span>
    </div>
</nav>

<div class="container mt-4">

    <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel" style="margin-top: 20px">
        <ol class="carousel-indicators">
            <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
            <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
            <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
            <li data-target="#carouselExampleIndicators" data-slide-to="3"></li>
        </ol>
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img class="d-block w-100" src="/static/images/slide1.jpg" style="max-height: 577px; width: 100%; object-fit: cover;">
            </div>
            <div class="carousel-item">
                <img class="d-block w-100" src="/static/images/slide2.jpg" style="max-height: 577px; width: 100%; object-fit: cover;">
            </div>
            <div class="carousel-item">
                <img class="d-block w-100" src="/static/images/slide3.jpg" style="max-height: 577px; width: 100%; object-fit: cover;">
            </div>
            <div class="carousel-item">
                <img class="d-block w-100" src="/static/images/slide4.jpg" style="max-height: 577px; width: 100%; object-fit: cover;">
            </div>
        </div>
        <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
        </a>
        <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
        </a>
    </div>


    <div style="margin-top: 50px">
        <h4 style="text-align: center; margin-bottom:15px">Пошук товарів</h4>
        <form th:action="@{/shop}" method="get" th:attr="data-product-count=${#lists.size(goods)}">
            <div class="search" style="display: flex; gap: 25px;">
                <input type="text" name="title" th:value="${title}" class="form-control" placeholder="Який товар шукаєте?" id="search">
                <button style="width: 15%; margin: 0px 0px 5px 0px" type="submit" class="btn btn-dark">Пошук</button>
            </div>
        </form><hr>
    </div>

    <div class="filter" style="margin:25px 0;">
        <form th:action="@{/filter}" method="get" onsubmit="return validateForm()">
    <div class="form-group" style="display: flex; justify-content: space-between; gap: 20px;">
        <select name="brand" id="searchBrand" class="form-control" title="Виберіть бренд">
            <option value="">-- Оберіть бренд --</option>
            <option th:each="brand : ${brand}" th:value="${brand.id_brand}">[[${brand.name_brand}]]</option>
        </select>

        <select name="model" id="searchModel" class="form-control" title="Виберіть модель">
            <option value="">-- Оберіть модель --</option>
        </select>

        <select name="categoryGroup" id="searchCat" class="form-control" title="Виберіть категорію" >
            <option value="">-- Оберіть категорію --</option>
            <option th:each="categoryGroup : ${categoryGroup}" th:value="${categoryGroup.id_category_group}">
                [[${categoryGroup.name_category_group}]]
            </option>
        </select>

        <select name="category" id="searchSubCat" class="form-control" title="Виберіть підкатегорію" >
            <option value="">-- Оберіть підкатегорію --</option>
        </select>

    </div>


            <div class="buttons" style="display: flex; gap:20px; justify-content: center;">
                <button style="width: 15%; margin: 0px 0px 5px 0px" type="submit" class="btn btn-dark">Пошук по фільтру</button>
                <button style="width: 15%; margin: 0px 0px 5px 0px" onclick="clearFilter()" class="btn btn-dark">Очистити фільтр</button>
            </div>
        </form>

    </div>

    <div>
        <h4 style="text-align: center; margin-top:40px">Товари з гарячою пропозицією</h4>
        <div class="card-deck" id="goods-container">
            <div th:if="!${#lists.isEmpty(goods)}">
                <div class="row">
                    <div th:each="item : ${goods}" th:if="${item.isHotDeal == true}" style="width: 380px; margin: 0 auto;">
                        <a th:href="@{/main/{idGood}(idGood=${item.id_good})}" class="product-link">
                            <div class="card text-white bg-dark my-3 product">
                                <div style="background-color:white;">
                                    <img th:src="@{/images/{previewImageId}(previewImageId=${item.previewImageId})}" class="card-img-top" style="height: 200px; object-fit: contain;">
                                </div>
                                <div class="card-body" style="min-height: 210px; text-decoration: none;">
                                    <h5 class="card-title" th:text="${item.title}" />
                                    <b th:text="${item.model.brand.name_brand}"></b>
                                    <b th:text="${item.model.name_model}"></b>
                                    <br>
                                    Категорія:
                                    <b style="font-style: normal;" th:text="${item.category.category_group.name_category_group}"></b>
                                    <br>
                                    Підкатегорія:
                                    <b style="font-style: normal;" th:text="${item.category.name_category}"></b>
                                    <div style="font-size: 25px;" th:if="${item.discount}">
                                        <s style=" color: #dc3545;"><i th:text="${item.price}"></i><i> грн.</i></s>
                                        <b style="color: #28a745; padding-left: 10px;" th:text="${item.discount}"></b> <b style="color: #28a745;"> грн.</b>
                                    </div>
                                    <div style="font-size: 25px;" th:unless="${item.discount}">
                                        <b th:text="${item.price}"></b> грн.
                                    </div>
                                </div>
                                <div class="card-footer" style="display: flex; flex-direction: row; gap: 25px; min-height: 45px;">
                                    <span th:if="${item.isHotDeal}" class="badge badge-pill badge-danger"> <i class="fas fa-fire"></i> Гаряча пропозиція</span>
                                    <span th:if="${item.discount}" class="badge badge-pill badge-success"> <i class="fas fa-percent"></i> Знижка</span>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
                <div class="text-center mt-4">
                    <button type="button" class="btn btn-secondary load-more-button" style="margin-bottom: 30px;">Завантажити ще</button>
                </div>
            </div>
        </div>
    </div>

    <div>
        <h4 style="text-align: center; margin-top:40px">Товари зі скидкою</h4>
        <div class="card-deck" id="goods-container2">
            <div th:if="!${#lists.isEmpty(goods)}">
                <div class="row">
                    <div th:each="item : ${goods}" th:if="${item.discount > 0}" style="width: 380px; margin: 0 auto;">
                        <a th:href="@{/main/{idGood}(idGood=${item.id_good})}" class="product-link">
                            <div class="card text-white bg-dark my-3 product">
                                <div style="background-color:white;">
                                    <img th:src="@{/images/{previewImageId}(previewImageId=${item.previewImageId})}" class="card-img-top" style="height: 200px; object-fit: contain;">
                                </div>
                                <div class="card-body" style="min-height: 210px; text-decoration: none;">
                                    <h5 class="card-title" th:text="${item.title}" />
                                    <b th:text="${item.model.brand.name_brand}"></b>
                                    <b th:text="${item.model.name_model}"></b>
                                    <br>
                                    Категорія:
                                    <b style="font-style: normal;" th:text="${item.category.category_group.name_category_group}"></b>
                                    <br>
                                    Підкатегорія:
                                    <b style="font-style: normal;" th:text="${item.category.name_category}"></b>
                                    <div style="font-size: 25px;" th:if="${item.discount}">
                                        <s style=" color: #dc3545;"><i th:text="${item.price}"></i><i> грн.</i></s>
                                        <b style="color: #28a745; padding-left: 10px;" th:text="${item.discount}"></b> <b style="color: #28a745;"> грн.</b>
                                    </div>
                                    <div style="font-size: 25px;" th:unless="${item.discount}">
                                        <b th:text="${item.price}"></b> грн.
                                    </div>
                                </div>
                                <div class="card-footer" style="display: flex; flex-direction: row; gap: 25px; min-height: 45px;">
                                    <span th:if="${item.isHotDeal}" class="badge badge-pill badge-danger"> <i class="fas fa-fire"></i> Гаряча пропозиція</span>
                                    <span th:if="${item.discount}" class="badge badge-pill badge-success"> <i class="fas fa-percent"></i> Знижка</span>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
                <div class="text-center mt-4">
                    <button type="button" id="loadMoreButton" class="btn btn-secondary load-more-button" style="margin-bottom: 30px;">Завантажити ще</button>
                </div>
            </div>
        </div>
    </div>
    </div>

<script src="https://cdn.jsdelivr.net/npm/slick-carousel/slick/slick.min.js"></script>


    <script th:inline="javascript">
    const goodsContainer = document.getElementById("goods-container");
    const loadMoreButton = document.querySelector(".load-more-button");

    const MAX_GOODS = 3;
    let currentGoods = MAX_GOODS;

    const goods = goodsContainer.querySelectorAll(".product");
    goods.forEach((item, index) => {
        if (index >= currentGoods) {
            item.style.display = "none";
        }
    });

    if (goods.length <= MAX_GOODS) {
        loadMoreButton.style.display = "none";
    }

    loadMoreButton.addEventListener("click", () => {
        currentGoods += MAX_GOODS;
        goods.forEach((item, index) => {
            if (index < currentGoods) {
                item.style.display = "block";
            }
        });
        if (currentGoods >= goods.length) {
            loadMoreButton.style.display = "none";
        }
    });
</script>

    <script th:inline="javascript">
    const goodsContainer2 = document.getElementById("goods-container2");
    const loadMoreButton2 = document.getElementById("loadMoreButton");

    const MAX_GOODS2 = 3;
    let currentGoods2 = MAX_GOODS2;

    const goods2 = goodsContainer2.querySelectorAll(".product");
    goods2.forEach((item, index) => {
        if (index >= currentGoods2) {
            item.style.display = "none";
        }
    });

    if (goods2.length <= MAX_GOODS2) {
        loadMoreButton2.style.display = "none";
    }

    loadMoreButton2.addEventListener("click", () => {
        currentGoods2 += MAX_GOODS2;
        goods2.forEach((item, index) => {
            if (index < currentGoods2) {
                item.style.display = "block";
            }
        });
        if (currentGoods2 >= goods2.length) {
            loadMoreButton2.style.display = "none";
        }
    });
</script>

    <script type="text/javascript">
    function clearFilter(){
    event.preventDefault();
    window.location = '/';
    }
</script>

<script>
    var brandSelect = document.getElementById("searchBrand");
    var modelSelect = document.getElementById("searchModel");

brandSelect.addEventListener("change", function() {
    modelSelect.innerHTML = "";

    var selectedBrand = brandSelect.value;

    // Створення початкового варіанту
    var initialOption = document.createElement("option");
    initialOption.value = "";
    initialOption.textContent = "-- Оберіть модель --";
    modelSelect.appendChild(initialOption);

    // Виклик AJAX-запиту для отримання моделей
    var xhr = new XMLHttpRequest();
    xhr.open("GET", "/getModel?model=" + selectedBrand);
    xhr.onreadystatechange = function() {
        if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
            var models = JSON.parse(xhr.responseText);

            // Додавання нових опцій у другий вибірник
            models.forEach(function(model) {
                var option = document.createElement("option");
                option.value = model.id_model;
                option.textContent = model.name_model + ' (' + model.year + ' р.)';
                modelSelect.appendChild(option);
            });
        }
    };
    xhr.send();
});
</script>


<script>
    var categorySelect = document.getElementById("searchCat");
    var subcategorySelect = document.getElementById("searchSubCat");

categorySelect.addEventListener("change", function() {
    subcategorySelect.innerHTML = "";

    var selectedCategory = categorySelect.value;

    // Створення початкового варіанту
    var initialOption = document.createElement("option");
    initialOption.value = "";
    initialOption.textContent = "-- Оберіть підкатегорію --";
    subcategorySelect.appendChild(initialOption);

    // Виклик AJAX-запиту для отримання підкатегорій
    var xhr = new XMLHttpRequest();
    xhr.open("GET", "/getSubcategory?category=" + selectedCategory);
    xhr.onreadystatechange = function() {
        if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
            var subcategories = JSON.parse(xhr.responseText);

            // Додавання нових опцій у другий вибірник
            subcategories.forEach(function(subcategory) {
                var option = document.createElement("option");
                option.value = subcategory.id_category;
                option.textContent = subcategory.name_category;
                subcategorySelect.appendChild(option);
            });
        }
    };
    xhr.send();
});
</script>

<script>
    function validateForm() {
        var brandSelect = document.getElementById("searchBrand");
        var modelSelect = document.getElementById("searchModel");
        var categorySelect = document.getElementById("searchCat");
        var subcategorySelect = document.getElementById("searchSubCat");

        if (!brandSelect.value && !modelSelect.value && !categorySelect.value && !subcategorySelect.value) {
            alert("Треба обрати хоча б один пункт із списка!");
            return false; // Перешкоджає відправці форми
        }
        return true; // Дозволяє відправку форми
    }
</script>


<script>
    $(document).ready(function () {
        $('.navbar-toggler').on('click', function () {
            $('.navbar-collapse').toggleClass('show');
        });
    });
</script>


<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
        integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"
        integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T"
        crossorigin="anonymous"></script>

<footer class="text-center text-lg-start bg-dark text-white">

    <!-- Section: Links  -->
    <section class="" >
        <div  class="container text-center text-md-start mt-5">
            <!-- Grid row -->
            <div class="row mt-3">
                <!-- Grid column -->
                <div class="col-md-3 col-lg-4 col-xl-3 mx-auto mb-4" style="margin-top:25px">
                    <!-- Content -->
                    <h6 class="text-uppercase fw-bold mb-4">
                        AVTOSENAT
                    </h6>
                    <p>
                        Інтернет-магазин автозапчастин, в наявності представлений асортимент як оригінальних так і ліцензійних запчастин.
                    </p>
                </div>
                <!-- Grid column -->

                <!-- Grid column -->
                <div class="col-md-2 col-lg-2 col-xl-2 mx-auto mb-4" style="margin-top:25px">
                    <!-- Links -->
                    <h6 class="text-uppercase fw-bold mb-4">
                        Корисні посилання
                    </h6>
                    <p>
                        <a class="text-reset" href="/about">
                            Про нас
                        </a>
                    </p>
                    <p>
                        <a class="text-reset" href="/shop">
                            Магазин
                        </a>
                    </p>
                    <p>
                        <a class="text-reset" href="/paymentAndDelivery">
                            Доставка та оплата
                        </a>
                    </p>
                    <p>
                        <a class="text-reset" href="/contacts">
                           Контакти
                        </a>
                    </p>
                </div>
                <!-- Grid column -->

                <!-- Grid column -->
                <div class="col-md-3 col-lg-2 col-xl-2 mx-auto mb-4" style="margin-top:25px">
                    <!-- Links -->
                    <h6 class="text-uppercase fw-bold mb-4">
                        Графік роботи
                    </h6>
                    <p>
                        Пн-Сб: 9.00 - 18.30
                    </p>
                    <p>
                        Нд: 10.00 - 16.00
                    </p>
                </div>
                <!-- Grid column -->

                <!-- Grid column -->
                <div class="col-md-4 col-lg-3 col-xl-3 mx-auto mb-md-0 mb-4" style="margin-top:25px">
                    <!-- Links -->
                    <h6 class="text-uppercase fw-bold mb-4">Контакти</h6>
                    <p><i class="fas fa-home me-3"></i> м. Київ, авторинок "Жуляни" сектор А, 2 ряд, №47</p>
                    <p>
                        <i class="fas fa-envelope me-3"></i>
                        info@avtosenat.com
                    </p>
                    <p>
                        <i class="fas fa-envelope me-3"></i>
                        avtosenat@ukr.net
                    </p>
                    <p><i class="fas fa-phone me-3"></i> (099)121-56-39</p>
                    <p><i class="fas fa-phone me-3"></i> (068)850-51-60</p>
                    <p><i class="fas fa-phone me-3"></i> (044)353-99-60</p>
                </div>
                <!-- Grid column -->
            </div>
            <!-- Grid row -->
        </div>
    </section>
    <!-- Section: Links  -->

    <!-- Copyright -->
    <div class="text-center p-4" style="background-color: rgba(0, 0, 0, 0.05);">
        © 2023  Всі права захищені.
        <a class="text-reset fw-bold" href="/">AVTOSENAT</a>
    </div>
    <!-- Copyright -->
</footer>
<!-- Footer -->

</body>
</html>